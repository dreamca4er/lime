drop table if exists #c
;

select
    ush.UserId
    , ush.Status
    , ush.CreatedByUserId
    , ush.DateCreated
into #c
from dbo.FrontendUsers fu
inner join dbo.UserStatusHistory ush on ush.UserId = fu.id
    and ush.IsLatest = 1
    and ush.Status not in (3, 6, 11)
where fu.id in
(
902412
,902410
,902407
,902405
,902398
,902397
,902396
,902394
,902391
,902390
,902389
,902382
,902380
,902377
,902376
,902375
,902373
,902372
,902371
,902370
,902364
,902363
,902360
,902359
,902354
,902351
,902350
,902349
,902348
,902347
,902345
,902344
,902341
,902339
,902336
,902334
,902332
,902331
,902329
,902328
,902327
,902324
,902323
,902322
,902321
,902320
,902319
,902318
,902317
,902316
,902315
,902314
,902313
,902312
,902310
,902308
,902307
,902306
,902304
,902302
,902301
,902300
,902299
,902298
,902296
,902295
,902293
,902291
,902286
,902285
,902284
,902283
,902280
,902278
,902276
,902274
,902272
,902271
,902270
,902269
,902267
,902266
,902265
,902262
,902261
,902258
,902255
,902254
,902252
,902251
,902247
,902245
,902241
,902239
,902236
,902235
,902233
,902232
,902230
,902227
,902226
,902224
,902223
,902221
,902220
,902206
,902202
,902097
,902028
,901056
,898064
,896817
,896270
,896053
,895537
,895367
,895367
,895303
,895303
,894148
,894015
,889547
,887892
,883726
,881589
,881341
,879243
,875407
,874515
,874206
,873138
,872906
,872127
,871382
,870542
,867897
,862876
,858964
,857890
,857872
,856182
,852837
,852815
,848019
,847538
,846413
,846002
,842060
,839011
,834949
,826142
,824631
,822065
,815756
,811329
,808556
,802083
,801071
,799899
,793419
,790965
,790844
,789330
,785150
,772700
,764291
,762583
,752712
,745643
,744582
,740343
,715019
,706154
,701544
,693170
,690442
,670643
,670268
,617500
,617279
,598768
,585073
,582461
,577640
,543755
,539557
,473218
,471902
,461899
,328001
,307474
,277165
,259607
,225210
,33671
,24056
,15643
)
go

select ush.*
-- update ush set IsLatest = 0, DateLastUpdated = getdate(), LastUpdatedByUserId = 1
from #c c
inner join dbo.UserStatusHistory ush on ush.UserId = c.userid
    and ush.IsLatest = 1
    and ush.DateCreated < '2019-01-15 06:45:35.137'
;

insert into dbo.UserStatusHistory (UserId,Status,IsLatest,DateCreated,CreatedByUserId)
select
    UserId
    , 2 as Status
    , 1 as IsLatest
    , getdate() as DateCreated
    , 1 as CreatedByUserId
from #c
/
select
    fu.id as UserId
    , fu.Lastname
    , fu.Firstname
    , fu.Fathername
    , fu.MobilePhone
    , fu.EmailAddress
from #c c
inner join dbo.FrontendUsers fu on fu.id = c.UserId  